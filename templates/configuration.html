<script>
function restart() {
	var request  = new XMLHttpRequest();
	request.open("GET", "restart");
	request.send("");
}
function sendData() {
	var form = document.form;
	var request  = new XMLHttpRequest();
	if (form.ssid.value == "" || form.identifier.value == "" || form.update == "") {
		return;
	}
	var params = encodeURI(form.ssid.name + "=" + form.ssid.value + "&" +
			form.password.name + "=" + form.password.value + "&" +
			form.identifier.name + "=" + form.identifier.value + "&" +
			form.sleepInterval.name + "=" + form.sleepInterval.value + "&" +
			form.otaUrl.name + "=" + form.otaUrl.value + "&" +
			form.otaUpdateInterval.name + "=" + form.otaUpdateInterval.value
	);
	request.open("GET", "set_config" + "?" + params);
	request.send("");
	setStatusText("Configuration changed");
	setTimeout("resetStatusText()", 3000);
}
function setStatusText(text) {
	var statusText = document.getElementById("fadeoutText");
	statusText.className = "fadeout";
	statusText.innerHTML = text;
}
function resetStatusText() {
	var statusText = document.getElementById("fadeoutText");
	statusText.className = "none";
	statusText.innerHTML = "";
}
function showPassword() {
    var field = document.getElementById("password");
    var button = document.getElementById("pwd");
    if (field.type == "password") {
        field.type = "text";
        button.value = "***";
    }
    else {
        field.type = "password";
        button.value = "abc";
    }
    ;
}
</script>

<style>
#fadeoutText.fadeout {
	opacity:0;
}
#fadeoutText {
	transition:opacity 3s;
	opacity:1;
}
fieldset {
	width:350px;
}
label.field {
	text-align:right;

	margin-right: 5px;
}
.pwd-button{
  display: inline;

}
</style>
	<iframe name="hidden_frame" style="display:none"></iframe>
<form name="form" action="/set_config" method="get" target="hidden_frame">
	<fieldset>
		<legend>ESP8266 Configuration</legend>
		<p><input type="text" name="ssid" placeHolder="SSID" required min="1" max="32" value="{{ssid}}"/></p>
		<p>
		<div>
		    <input type="password" id="password" name="password" placeHolder="Password" min="0" max="32" value="{{password}}"/>
				<input type="button" class="pwd-button" id="pwd" onClick="showPassword();" title="Show/hide password" value="abc"/>
		</div>
		</p>
		<p><input type="text" name="identifier" placeHolder="Identifier" required min="1" max="32" value="{{identifier}}"/></p>
		<p><input type="number" name="sleepInterval" placeHolder="Sleep Interval" required min="1" max="9999" value="{{sleepInterval}}"/></p>
		<p><input type="text" name="otaUrl" placeHolder="OTA URL" min="0" max="32" value="{{otaUrl}}"/></p>
		<p><input type="number" name="otaUpdateInterval" placeHolder="OTA Interval" min="0" max="9999" value="{{otaUpdateInterval}}"/></p>
  		<input type="button" value="update" onClick="sendData();">
		<input type="button" value="Restart ESP8266" onClick="restart();">
	</fieldset>
</form>
<label id="fadeoutText"></label>
